<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Python从入门到实践项目二:数据可视化 | liump blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Python学习(book):<<Python编程:从入门到实践>> 项目二">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.a696ca11.css" as="style"><link rel="preload" href="/assets/js/app.91516f2d.js" as="script"><link rel="preload" href="/assets/js/7.58fd3bc6.js" as="script"><link rel="preload" href="/assets/js/4.d132524d.js" as="script"><link rel="preload" href="/assets/js/31.b3c49d70.js" as="script"><link rel="prefetch" href="/assets/js/10.5a15dfbe.js"><link rel="prefetch" href="/assets/js/11.922b18ab.js"><link rel="prefetch" href="/assets/js/12.218ced56.js"><link rel="prefetch" href="/assets/js/13.53b94774.js"><link rel="prefetch" href="/assets/js/14.417e3490.js"><link rel="prefetch" href="/assets/js/15.5f116638.js"><link rel="prefetch" href="/assets/js/16.7f9b1663.js"><link rel="prefetch" href="/assets/js/17.ca45f10f.js"><link rel="prefetch" href="/assets/js/18.3b6d9425.js"><link rel="prefetch" href="/assets/js/19.65e051f1.js"><link rel="prefetch" href="/assets/js/20.57af5642.js"><link rel="prefetch" href="/assets/js/21.585ed1cc.js"><link rel="prefetch" href="/assets/js/22.8f4f87e2.js"><link rel="prefetch" href="/assets/js/23.b4bb26b9.js"><link rel="prefetch" href="/assets/js/24.b6ef6552.js"><link rel="prefetch" href="/assets/js/25.6bc27fe9.js"><link rel="prefetch" href="/assets/js/26.c2453e05.js"><link rel="prefetch" href="/assets/js/27.ab1cadd8.js"><link rel="prefetch" href="/assets/js/28.637aa2f9.js"><link rel="prefetch" href="/assets/js/29.11c7b616.js"><link rel="prefetch" href="/assets/js/30.f134215e.js"><link rel="prefetch" href="/assets/js/32.e06cc7a8.js"><link rel="prefetch" href="/assets/js/33.90702da1.js"><link rel="prefetch" href="/assets/js/34.17b2afe0.js"><link rel="prefetch" href="/assets/js/35.77883eeb.js"><link rel="prefetch" href="/assets/js/36.87fcbc32.js"><link rel="prefetch" href="/assets/js/37.148ddbee.js"><link rel="prefetch" href="/assets/js/38.dc3b335e.js"><link rel="prefetch" href="/assets/js/39.a1de5ec6.js"><link rel="prefetch" href="/assets/js/40.2f932922.js"><link rel="prefetch" href="/assets/js/41.291cd0d0.js"><link rel="prefetch" href="/assets/js/42.bcd318b1.js"><link rel="prefetch" href="/assets/js/43.a14da8e4.js"><link rel="prefetch" href="/assets/js/44.0c68ec25.js"><link rel="prefetch" href="/assets/js/45.f4f168e0.js"><link rel="prefetch" href="/assets/js/46.5e00d3be.js"><link rel="prefetch" href="/assets/js/47.511cd318.js"><link rel="prefetch" href="/assets/js/48.ba453816.js"><link rel="prefetch" href="/assets/js/49.a08d7f7a.js"><link rel="prefetch" href="/assets/js/5.ce657947.js"><link rel="prefetch" href="/assets/js/50.b84b0339.js"><link rel="prefetch" href="/assets/js/51.8ed0687f.js"><link rel="prefetch" href="/assets/js/52.9b4d4efc.js"><link rel="prefetch" href="/assets/js/53.f3977826.js"><link rel="prefetch" href="/assets/js/54.eb790e0e.js"><link rel="prefetch" href="/assets/js/55.1664b3bc.js"><link rel="prefetch" href="/assets/js/56.3be8657f.js"><link rel="prefetch" href="/assets/js/57.37c6586e.js"><link rel="prefetch" href="/assets/js/58.2b0d87f5.js"><link rel="prefetch" href="/assets/js/59.a15317dd.js"><link rel="prefetch" href="/assets/js/6.c9d0d5d7.js"><link rel="prefetch" href="/assets/js/60.04ceac63.js"><link rel="prefetch" href="/assets/js/61.69c3a5f6.js"><link rel="prefetch" href="/assets/js/62.ea97ea9c.js"><link rel="prefetch" href="/assets/js/8.100c3933.js"><link rel="prefetch" href="/assets/js/9.acdb2e2e.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.9283cff1.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.99c484cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a696ca11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">liump blog </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">文章</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="/document/" class="nav-link">资源</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">liump blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">文章</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="/document/" class="nav-link">资源</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Python从入门到实践项目二:数据可视化
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">liump</span> <span itemprop="address">   in WuHan</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-3-10">
      2020-03-10
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/Python" data-v-d832e844> Python </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><blockquote><p>Python 从入门到实践项目二 数据可视化</p></blockquote> <h2 id="安装-matplotlib"><a href="#安装-matplotlib" class="header-anchor">#</a> 安装 matplotlib</h2> <p>window 系统 cmd中 pip install matplotlib<br>
Pycharm 设置: settings -&gt; project:xxx -&gt; project Interpreter选择Python版本和项目对应需要的包,本项目需要 Install matplotlib</p> <h2 id="matplotlib-画廊"><a href="#matplotlib-画廊" class="header-anchor">#</a> matplotlib 画廊</h2> <p>要查看使用matplotlib可制作的各种图标,请访问 <a href="http://matplotlib.org" target="_blank" rel="noopener noreferrer">matplotlib官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的实例画廊,单击画廊中的图标,就可查看用于生成图表的代码.</p> <h2 id="绘制简单的折线图"><a href="#绘制简单的折线图" class="header-anchor">#</a> 绘制简单的折线图</h2> <p>mpl_squares.py</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>squares<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>修改标签文字和线条粗细</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>squares<span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图表标题,并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Square Numbers&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Square of Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token comment"># 设置刻度标记的大小</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span>labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>校正图形</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># plot()提供一系列数字时,X坐标默认从0开始.</span>
input_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>input_values<span class="token punctuation">,</span> squares<span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="使用scatter-绘制散点图并设置其样式"><a href="#使用scatter-绘制散点图并设置其样式" class="header-anchor">#</a> 使用scatter()绘制散点图并设置其样式</h2> <p>scatter_squares.py</p> <ul><li>绘制单个点,可以使用函数scatter(),并向它传递一队x和y坐标.</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>设置样式</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment"># s 点的尺寸</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Square Numbers&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Square of Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>使用scatter()绘制一系列点</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
x_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
y_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Square Numbers&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Square of Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>自动计算数据
使用循环来替我们完成这种计算.下面是绘制1000个点的代码:<br>
其中使用了颜色映射,c=y_values, cmap=plt.cm.Reds就是红色渐变映射,还可以使用Bules,其他颜色的映射参考官网.</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
x_values <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_values <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> x_values<span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_values<span class="token punctuation">,</span> y_values<span class="token punctuation">,</span> c<span class="token operator">=</span>y_values<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Reds<span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图表标题并给坐标轴加上标签</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Square Numbers&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Square of Value&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1100000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>自动保存图表
<ul><li>要让程序自动将图表保存到文件中,可将对plt.show()的调用替换为对plt.savefig()的调用</li> <li><code>plt.savefig('square_plot.png', bbox_inches='tight')</code></li> <li>第一个实参指定要以什么样的文件名保存图表,第二个实参指定将图表多余的空白区域裁减掉.如果不需要裁剪可以省略.</li></ul></li></ul> <h2 id="随机漫步"><a href="#随机漫步" class="header-anchor">#</a> 随机漫步</h2> <p>随机漫步是这样行走得到的路径:每次行走都完全是随机的,没有明确的方向,结果是有一系列随机决策决定的.可以这样认为,随机漫步就是蚂蚁在晕头转向的情况下,每次都沿随机的方向前行所经过的路径.<br>
在自然界 / 物理学 / 生物学 / 化学和经济领域,随机漫步都有其实际用途.例如:漂浮在水滴上的花粉因不断受到水分子的挤压而在水面上移动,水滴中的分子运动是随机的,因此花粉在水面上的运动路径犹如随机漫步.</p> <ol><li>创建RandomWalk()类
random_walk.py</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> random <span class="token keyword">import</span> choice
<span class="token keyword">class</span> <span class="token class-name">RandomWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;一个生成随机漫步数据的类&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_points<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;初始化随机漫步的属性&quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>num_points <span class="token operator">=</span> num_points
        <span class="token comment"># 所有随机漫步都始于(0, 0)</span>
        self<span class="token punctuation">.</span>x_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>y_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>


    <span class="token keyword">def</span> <span class="token function">fill_walk</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;计算随机漫步包含的所有点&quot;&quot;&quot;</span>
        <span class="token comment"># 不断漫步,直到列表达到指定的长度</span>
        <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x_values<span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>num_points<span class="token punctuation">:</span>
            <span class="token comment"># 决定前进方向以及沿这个方向前进的距离</span>
            x_direction <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            x_distance <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            x_step <span class="token operator">=</span> x_direction <span class="token operator">*</span> x_distance
            y_direction <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            y_distance <span class="token operator">=</span> choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            y_step <span class="token operator">=</span> y_direction <span class="token operator">*</span> y_distance
            <span class="token comment"># 拒绝原地踏步</span>
            <span class="token keyword">if</span> x_step <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> y_step <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token comment"># 计算下一个点的x和y值</span>
            next_x <span class="token operator">=</span> self<span class="token punctuation">.</span>x_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>x_step
            next_y <span class="token operator">=</span> self<span class="token punctuation">.</span>y_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>y_step
            self<span class="token punctuation">.</span>x_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_x<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>y_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_y<span class="token punctuation">)</span>

</code></pre></div><ol start="2"><li>绘制多次随机漫步
rw_visual.py</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> random_walk <span class="token keyword">import</span> RandomWalk
<span class="token comment"># 创建一个RandomWalk实例,并将其包含的点都绘制出来</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个RandomWalk实例,并向其包含的点都绘制出来</span>
    rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    point_number <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>rw<span class="token punctuation">.</span>num_points<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span>c<span class="token operator">=</span>point_number<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">,</span>edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token comment"># 突出起点和终点</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span>edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    keep_running <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;Make another walk?(y/n):&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> keep_running <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre></div><ol start="3"><li>隐藏坐标轴</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> random_walk <span class="token keyword">import</span> RandomWalk
<span class="token comment"># 创建一个RandomWalk实例,并将其包含的点都绘制出来</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个RandomWalk实例,并向其包含的点都绘制出来</span>
    rw <span class="token operator">=</span> RandomWalk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rw<span class="token punctuation">.</span>fill_walk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    point_number <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>rw<span class="token punctuation">.</span>num_points<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">,</span>c<span class="token operator">=</span>point_number<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">,</span>edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token comment"># 突出起点和终点</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span>edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>rw<span class="token punctuation">.</span>x_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rw<span class="token punctuation">.</span>y_values<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token comment"># 隐藏坐标轴</span>
    plt<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_xaxis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_yaxis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">break</span>
    keep_running <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;Make another walk?(y/n):&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> keep_running <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre></div><h2 id="使用pygal-模拟掷骰子"><a href="#使用pygal-模拟掷骰子" class="header-anchor">#</a> 使用Pygal 模拟掷骰子</h2> <p><a href="http://www.pygal.org" target="_blank" rel="noopener noreferrer">Pygal官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>创建Die类</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> random <span class="token keyword">import</span> randint


<span class="token keyword">class</span> <span class="token class-name">Die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;表示一个骰子的类&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_sides<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;骰子默认为6面&quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>num_sides <span class="token operator">=</span> num_sides

    <span class="token keyword">def</span> <span class="token function">roll</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;返回一个位于1和骰子面数之间的随机值&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_sides<span class="token punctuation">)</span>

</code></pre></div><p>方法roll()使用函数randint()来返回一个1和面数(6)之间的随机数.<br>
2. 掷骰子
先打印结果查看数据是否正常</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建一个D6</span>
die <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 掷几次骰子,并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>分析结果</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建一个D6</span>
die <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 掷几次骰子,并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> die<span class="token punctuation">.</span>num_sides<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>frequencies<span class="token punctuation">)</span>

</code></pre></div><ol start="4"><li>绘制直方图</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pygal
<span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建一个D6</span>
die <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 掷几次骰子,并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> die<span class="token punctuation">.</span>num_sides<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
<span class="token comment"># 对结果进行可视化</span>
hist <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
hist<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;Results of rolling one D6 1000 times&quot;</span>
hist<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">]</span>
hist<span class="token punctuation">.</span>x_title <span class="token operator">=</span> <span class="token string">'Result'</span>
hist<span class="token punctuation">.</span>y_title <span class="token operator">=</span> <span class="token string">'Frequency of Result'</span>
hist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'D6'</span><span class="token punctuation">,</span> frequencies<span class="token punctuation">)</span>
hist<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'die_visual.svg'</span><span class="token punctuation">)</span>

</code></pre></div><p>Pygal 让这个图表具有交互性:如果你将鼠标指向该图表中的任何条形,将看到与之相关联的数据.<br>
5. 同时掷两个骰子</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pygal
<span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建一个D6</span>
die_1 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
die_2 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 掷几次骰子,并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> roll_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> die_1<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> die_2<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
max_result <span class="token operator">=</span> die_1<span class="token punctuation">.</span>num_sides<span class="token operator">+</span>die_2<span class="token punctuation">.</span>num_sides
<span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> max_result<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frequency <span class="token operator">=</span> results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    frequencies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frequency<span class="token punctuation">)</span>
<span class="token comment"># 对结果进行可视化</span>
hist <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
hist<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;Results of rolling one D6 1000 times&quot;</span>
hist<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
hist<span class="token punctuation">.</span>x_title <span class="token operator">=</span> <span class="token string">'Result'</span>
hist<span class="token punctuation">.</span>y_title <span class="token operator">=</span> <span class="token string">'Frequency of Result'</span>
hist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'D6+D6'</span><span class="token punctuation">,</span> frequencies<span class="token punctuation">)</span>
hist<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'die_visual.svg'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="6"><li>重构 将for循环替换为列表推导式</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pygal
<span class="token keyword">from</span> die <span class="token keyword">import</span> Die

<span class="token comment"># 创建一个D6</span>
die_1 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
die_2 <span class="token operator">=</span> Die<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 掷几次骰子,并将结果存储在一个列表中</span>
results <span class="token operator">=</span> <span class="token punctuation">[</span>die_1<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>die_2<span class="token punctuation">.</span>roll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 分析结果</span>
frequencies <span class="token operator">=</span> <span class="token punctuation">[</span>results<span class="token punctuation">.</span>count<span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token keyword">for</span> val <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> die_1<span class="token punctuation">.</span>num_sides<span class="token operator">+</span>die_2<span class="token punctuation">.</span>num_sides<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 对结果进行可视化</span>
hist <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
hist<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;Results of rolling one D6 1000 times&quot;</span>
hist<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
hist<span class="token punctuation">.</span>x_title <span class="token operator">=</span> <span class="token string">'Result'</span>
hist<span class="token punctuation">.</span>y_title <span class="token operator">=</span> <span class="token string">'Frequency of Result'</span>
hist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'D6+D6'</span><span class="token punctuation">,</span> frequencies<span class="token punctuation">)</span>
hist<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'die_visual.svg'</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="下载数据"><a href="#下载数据" class="header-anchor">#</a> 下载数据</h2> <h3 id="csv"><a href="#csv" class="header-anchor">#</a> CSV</h3> <p>访问并可视化以两种常见格式存储的数据: CSV和JSON<br>
使用Python模块csv来处理以CSV格式存储的天气数据,使用matplotlib根据下载的数据创建图表.<br>
使用json来访问以JSON格式存储的交易收盘价数据,并使用Pygal绘制图形以探索加个变化的周期性.</p> <ol><li>CSV文件格式
csv文件是以逗号分隔的数据.</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> csv
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 从文件中获取最高气温</span>
filename <span class="token operator">=</span> <span class="token string">'sitka_weather_07-2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    highs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>highs<span class="token punctuation">)</span>

<span class="token comment"># 根据数据绘制图形</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Daily high temperatures, July 2014&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Temperature(F)&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>模块datetime
| 实参| 含义												|
|--		|--													|
|%A		|星期的名称, 如Monday				|
|%B		|月份名, 如January						|
|%m		|用数字表示的月份							|
|%d		|用数字表示月份中的一天(01-31)|
|%Y		|四位的年份,如2019						|
|%y		|两位的年份,如19							|
|%H		|24小时制的小时数(00-23)			|
|%I		|12小时制的小时数(01-12)			|
|%p		|am或pm											|
|%M		|分钟数(00-59)								|
|%S		|秒数(00-61)									|</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> csv
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 从文件中获取最高气温</span>
filename <span class="token operator">=</span> <span class="token string">'sitka_weather_2014.csv'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        current_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m-%d&quot;</span><span class="token punctuation">)</span>
        dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_date<span class="token punctuation">)</span>
        high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>
        low <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        lows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>low<span class="token punctuation">)</span>

<span class="token comment"># 根据数据绘制图形</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token comment"># 填充区间色</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Daily high and low temperatures - 2014&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>autofmt_xdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Temperature(F)&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>错误检查
使用 try except else 处理数据缺省的问题.</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> csv
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt


<span class="token comment"># 从文件中获取最高气温</span>
filename <span class="token operator">=</span> <span class="token string">'death_valley_2014.csv'</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    header_row <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            current_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m-%d&quot;</span><span class="token punctuation">)</span>
            high <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            low <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>current_date<span class="token punctuation">,</span> <span class="token string">'missing data'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_date<span class="token punctuation">)</span>
            highs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>high<span class="token punctuation">)</span>
            lows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>low<span class="token punctuation">)</span>

<span class="token comment"># 根据数据绘制图形</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>dpi<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> highs<span class="token punctuation">,</span> lows<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token comment"># 设置图形的格式</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;Daily high and low temperatures - 2014\nDeath Valley, CA&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>autofmt_xdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&quot;Temperature(F)&quot;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span> which<span class="token operator">=</span><span class="token string">'major'</span><span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="json"><a href="#json" class="header-anchor">#</a> JSON</h3> <ol><li>制作交易收盘价走势图: JSON格式
提取 JSON 数据<br>
将部分数值转换为int类型</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> json
<span class="token comment"># 将数据加载到一个列表中</span>
filename <span class="token operator">=</span> <span class="token string">'btc_close_2017.json'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    btc_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    date <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span>
    month <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    week <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    weekday <span class="token operator">=</span> btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span>
    close <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{} is month {} week {}, {}, the close price is {} RMB&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> month<span class="token punctuation">,</span> week<span class="token punctuation">,</span> weekday<span class="token punctuation">,</span> close<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><ol start="2"><li>绘制收盘价折线图</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> json
<span class="token keyword">import</span> pygal

<span class="token comment"># 将数据加载到一个列表中</span>
filename <span class="token operator">=</span> <span class="token string">'btc_close_2017.json'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    btc_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weeks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weekdays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
close <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    months<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weeks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weekdays<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span>x_label_rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> show_minor_x_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">'收盘价(¥)'</span>
line_chart<span class="token punctuation">.</span>x_labels<span class="token operator">=</span>dates
N <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># x轴坐标每隔20天显示一次</span>
line_chart<span class="token punctuation">.</span>x_labels_major<span class="token operator">=</span>dates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'收盘价'</span><span class="token punctuation">,</span> close<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价折线图(¥).svg'</span><span class="token punctuation">)</span>

</code></pre></div><ol start="3"><li>时间系列特征初探
进行时间序列分析总是期望发现趋势(trend) 、 周期性(seasonality)和噪声(noise),从而能够描述事实、预测未来、做出决策、.从收盘价的折线图可以看出,2017年的总体趋势是非线性的,而且正常幅度不断增大,视乎呈指数分布.但是,我们还发现,在每个季度末(3月,6月和9月)视乎有一些相似的波动.尽管这些波动被增长的趋势掩盖了,不过其中也许有周期性.为了验证周期性的假设,需要首先将非线性的趋势消除.对数变换(log transormation)是常用的处理方法之一.让我们用Python标准库的数学模块math来解决这个问题.math里有许多常用的数学函数,这里以10为底的对数函数math.log10计算收盘价,日期仍然保持不变.这种方式称为半对数(semi-logarithmic)变换.代码如下:</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> json
<span class="token keyword">import</span> pygal
<span class="token keyword">import</span> math
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> groupby

<span class="token comment"># 将数据加载到一个列表中</span>
filename <span class="token operator">=</span> <span class="token string">'btc_close_2017.json'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    btc_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weeks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weekdays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
close <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    months<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weeks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weekdays<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span>x_label_rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> show_minor_x_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">'收盘价对数变换(¥)'</span>
line_chart<span class="token punctuation">.</span>x_labels<span class="token operator">=</span>dates
N <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># x轴坐标每隔20天显示一次</span>
line_chart<span class="token punctuation">.</span>x_labels_major<span class="token operator">=</span>dates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
close_log <span class="token operator">=</span> <span class="token punctuation">[</span>math<span class="token punctuation">.</span>log10<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> close<span class="token punctuation">]</span>
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'log收盘价'</span><span class="token punctuation">,</span> close_log<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价对数变换折线图(¥).svg'</span><span class="token punctuation">)</span>

</code></pre></div><ol start="4"><li>收盘价均值
由于需要将数据按月份、周数、周几分组,再计算每组的均值,因此我们导入Python标准库中模块itertools的函数groupby.然后将x轴与y轴的数据合并、排序，再用函数groupby分组.分组之后求出每组的均值,存储到xy_map变量中.最后,将xy_map中存储的x轴与y轴数据分离,就可以像之前那样用Pygal画图了.下面我们画出收盘价月日均值.由于2017年12月的数据并不完整,我们支取2017年1月到11月的数据.通过dates查找2017-12-01的索引位置,确定周数和收盘价的区属范围.代码如下:</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> groupby
<span class="token keyword">def</span> <span class="token function">draw_line</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">,</span> title<span class="token punctuation">,</span> y_legend<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xy_map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> groupby<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> _<span class="token punctuation">:</span> _<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_list <span class="token operator">=</span> <span class="token punctuation">[</span>v <span class="token keyword">for</span> _<span class="token punctuation">,</span>v <span class="token keyword">in</span> y<span class="token punctuation">]</span>
        xy_map<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    x_unique<span class="token punctuation">,</span> y_mean <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>xy_map<span class="token punctuation">)</span><span class="token punctuation">]</span>
    line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
    line_chart<span class="token punctuation">.</span>title <span class="token operator">=</span> title
    line_chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> x_unique
    line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>y_legend<span class="token punctuation">,</span> y_mean<span class="token punctuation">)</span>
    line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span>title<span class="token operator">+</span><span class="token string">'.svg'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> line_chart


idx_month <span class="token operator">=</span> dates<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'2017-12-01'</span><span class="token punctuation">)</span>
line_chart_month <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>months<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价月日均值(¥)'</span><span class="token punctuation">,</span><span class="token string">'月日均值'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>代码汇总
为交易收盘价绘制的五福图,分别是收盘价对数变换、收盘价月日均值、收盘价周日均值、收盘价星期均值。每个SVG文件打开之后都是独立的页面.</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> json
<span class="token keyword">import</span> pygal
<span class="token keyword">import</span> math
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> groupby

<span class="token comment"># 将数据加载到一个列表中</span>
filename <span class="token operator">=</span> <span class="token string">'btc_close_2017.json'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    btc_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weeks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weekdays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
close <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    months<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weeks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weekdays<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span>x_label_rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> show_minor_x_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">'收盘价对数变换(¥)'</span>
line_chart<span class="token punctuation">.</span>x_labels<span class="token operator">=</span>dates
N <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># x轴坐标每隔20天显示一次</span>
line_chart<span class="token punctuation">.</span>x_labels_major<span class="token operator">=</span>dates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
close_log <span class="token operator">=</span> <span class="token punctuation">[</span>math<span class="token punctuation">.</span>log10<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> close<span class="token punctuation">]</span>
<span class="token comment"># line_chart.add('收盘价', close)</span>
<span class="token comment"># line_chart.render_to_file('收盘价折线图(¥).svg')</span>
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'log收盘价'</span><span class="token punctuation">,</span> close_log<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价对数变换折线图(¥).svg'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">draw_line</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">,</span> title<span class="token punctuation">,</span> y_legend<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xy_map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> groupby<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> _<span class="token punctuation">:</span> _<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_list <span class="token operator">=</span> <span class="token punctuation">[</span>v <span class="token keyword">for</span> _<span class="token punctuation">,</span>v <span class="token keyword">in</span> y<span class="token punctuation">]</span>
        xy_map<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    x_unique<span class="token punctuation">,</span> y_mean <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>xy_map<span class="token punctuation">)</span><span class="token punctuation">]</span>
    line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
    line_chart<span class="token punctuation">.</span>title <span class="token operator">=</span> title
    line_chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> x_unique
    line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>y_legend<span class="token punctuation">,</span> y_mean<span class="token punctuation">)</span>
    line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span>title<span class="token operator">+</span><span class="token string">'.svg'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> line_chart


idx_month <span class="token operator">=</span> dates<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'2017-12-01'</span><span class="token punctuation">)</span>
line_chart_month <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>months<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价月日均值(¥)'</span><span class="token punctuation">,</span><span class="token string">'月日均值'</span><span class="token punctuation">)</span>

idx_week <span class="token operator">=</span> dates<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'2017-12-11'</span><span class="token punctuation">)</span>
line_chart_week <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>weeks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价周日均值(¥)'</span><span class="token punctuation">,</span> <span class="token string">'周日均值'</span><span class="token punctuation">)</span>

wd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Monday'</span><span class="token punctuation">,</span> <span class="token string">'Tuesday'</span><span class="token punctuation">,</span> <span class="token string">'Wednesday'</span><span class="token punctuation">,</span> <span class="token string">'Thursday'</span><span class="token punctuation">,</span> <span class="token string">'Friday'</span><span class="token punctuation">,</span> <span class="token string">'Saturday'</span><span class="token punctuation">,</span> <span class="token string">'Sunday'</span><span class="token punctuation">]</span>
weekdays_int <span class="token operator">=</span> <span class="token punctuation">[</span>wd<span class="token punctuation">.</span>index<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> weekdays<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">]</span>
line_chart_weekday <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>weekdays_int<span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价星期均值(¥)'</span><span class="token punctuation">,</span> <span class="token string">'星期均值'</span><span class="token punctuation">)</span>
line_chart_weekday<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'周一'</span><span class="token punctuation">,</span> <span class="token string">'周二'</span><span class="token punctuation">,</span> <span class="token string">'周三'</span><span class="token punctuation">,</span> <span class="token string">'周四'</span><span class="token punctuation">,</span> <span class="token string">'周五'</span><span class="token punctuation">,</span> <span class="token string">'周六'</span><span class="token punctuation">,</span> <span class="token string">'周日'</span><span class="token punctuation">]</span>
line_chart_weekday<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价星期均值(¥).svg'</span><span class="token punctuation">)</span>

</code></pre></div><ol start="6"><li>收盘价数据仪表盘</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> json
<span class="token keyword">import</span> pygal
<span class="token keyword">import</span> math
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> groupby

<span class="token comment"># 将数据加载到一个列表中</span>
filename <span class="token operator">=</span> <span class="token string">'btc_close_2017.json'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    btc_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weeks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
weekdays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
close <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 每一天的信息</span>
<span class="token keyword">for</span> btc_dict <span class="token keyword">in</span> btc_data<span class="token punctuation">:</span>
    dates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    months<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weeks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'week'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    weekdays<span class="token punctuation">.</span>append<span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'weekday'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>btc_dict<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span>x_label_rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> show_minor_x_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">'收盘价(¥)'</span>
line_chart<span class="token punctuation">.</span>x_labels<span class="token operator">=</span>dates
N <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment"># x轴坐标每隔20天显示一次</span>
line_chart<span class="token punctuation">.</span>x_labels_major<span class="token operator">=</span>dates<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
close_log <span class="token operator">=</span> <span class="token punctuation">[</span>math<span class="token punctuation">.</span>log10<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> close<span class="token punctuation">]</span>
line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'收盘价'</span><span class="token punctuation">,</span> close<span class="token punctuation">)</span>
line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价折线图(¥).svg'</span><span class="token punctuation">)</span>
<span class="token comment"># line_chart.add('log收盘价', close_log)</span>
<span class="token comment"># line_chart.render_to_file('收盘价对数变换折线图(¥).svg')</span>

<span class="token keyword">def</span> <span class="token function">draw_line</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">,</span> title<span class="token punctuation">,</span> y_legend<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xy_map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> groupby<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> _<span class="token punctuation">:</span> _<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_list <span class="token operator">=</span> <span class="token punctuation">[</span>v <span class="token keyword">for</span> _<span class="token punctuation">,</span>v <span class="token keyword">in</span> y<span class="token punctuation">]</span>
        xy_map<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_list<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    x_unique<span class="token punctuation">,</span> y_mean <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>xy_map<span class="token punctuation">)</span><span class="token punctuation">]</span>
    line_chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
    line_chart<span class="token punctuation">.</span>title <span class="token operator">=</span> title
    line_chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> x_unique
    line_chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span>y_legend<span class="token punctuation">,</span> y_mean<span class="token punctuation">)</span>
    line_chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span>title<span class="token operator">+</span><span class="token string">'.svg'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> line_chart


idx_month <span class="token operator">=</span> dates<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'2017-12-01'</span><span class="token punctuation">)</span>
line_chart_month <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>months<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token punctuation">:</span>idx_month<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价月日均值(¥)'</span><span class="token punctuation">,</span><span class="token string">'月日均值'</span><span class="token punctuation">)</span>

idx_week <span class="token operator">=</span> dates<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'2017-12-11'</span><span class="token punctuation">)</span>
line_chart_week <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>weeks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价周日均值(¥)'</span><span class="token punctuation">,</span> <span class="token string">'周日均值'</span><span class="token punctuation">)</span>

wd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Monday'</span><span class="token punctuation">,</span> <span class="token string">'Tuesday'</span><span class="token punctuation">,</span> <span class="token string">'Wednesday'</span><span class="token punctuation">,</span> <span class="token string">'Thursday'</span><span class="token punctuation">,</span> <span class="token string">'Friday'</span><span class="token punctuation">,</span> <span class="token string">'Saturday'</span><span class="token punctuation">,</span> <span class="token string">'Sunday'</span><span class="token punctuation">]</span>
weekdays_int <span class="token operator">=</span> <span class="token punctuation">[</span>wd<span class="token punctuation">.</span>index<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> weekdays<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">]</span>
line_chart_weekday <span class="token operator">=</span> draw_line<span class="token punctuation">(</span>weekdays_int<span class="token punctuation">,</span> close<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>idx_week<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'收盘价星期均值(¥)'</span><span class="token punctuation">,</span> <span class="token string">'星期均值'</span><span class="token punctuation">)</span>
line_chart_weekday<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'周一'</span><span class="token punctuation">,</span> <span class="token string">'周二'</span><span class="token punctuation">,</span> <span class="token string">'周三'</span><span class="token punctuation">,</span> <span class="token string">'周四'</span><span class="token punctuation">,</span> <span class="token string">'周五'</span><span class="token punctuation">,</span> <span class="token string">'周六'</span><span class="token punctuation">,</span> <span class="token string">'周日'</span><span class="token punctuation">]</span>
line_chart_weekday<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'收盘价星期均值(¥).svg'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'收盘价Dashboard.html'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> html_file<span class="token punctuation">:</span>
    html_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;收盘价Dashboard&lt;/title&gt;&lt;meta charset=&quot;utf8&quot;&gt;&lt;/head&gt;&lt;/html&gt;&lt;body&gt;\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> svg <span class="token keyword">in</span> <span class="token punctuation">[</span>
        <span class="token string">'收盘价折线图(¥).svg'</span><span class="token punctuation">,</span>
        <span class="token string">'收盘价对数变换折线图(¥).svg'</span><span class="token punctuation">,</span>
        <span class="token string">'收盘价月日均值(¥).svg'</span><span class="token punctuation">,</span>
        <span class="token string">'收盘价周日均值(¥).svg'</span><span class="token punctuation">,</span>
        <span class="token string">'收盘价星期均值(¥).svg'</span>
    <span class="token punctuation">]</span><span class="token punctuation">:</span>
        html_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'&lt;object type=&quot;image/svg+xml&quot; data=&quot;{0}&quot; height=500&gt;&lt;/object&gt;\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    html_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'&lt;/body&gt;&lt;/html&gt;'</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="使用api"><a href="#使用api" class="header-anchor">#</a> 使用API</h2> <h3 id="使用web-api"><a href="#使用web-api" class="header-anchor">#</a> 使用Web API</h3> <ol><li>了解Git、GitHub
<a href="github.com">GitHub</a></li> <li>使用API调用请求数据
<code>https://api.github.com/search/repositories?q=language:python&amp;sort=stars</code>
这个调用返回GitHub当前托管了多少个Python项目,还有有关最受欢迎的Python仓库的信息.</li> <li>安装 requests
<code>pip install requests</code>
如果使用Pycharm在设置中配置项目所需要的包.</li> <li>处理API响应
python_repos.py</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> requests
<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&quot;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Status code:&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 处理结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>处理响应字典</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> requests
<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&quot;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Status code:&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total repositories:'</span><span class="token punctuation">,</span>response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Repositories returned:'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dicts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 研究第一个仓库</span>
repo_dict <span class="token operator">=</span> repo_dicts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nSelected information about first repository:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Name:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Owner:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'owner'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Stars:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Repository:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'html_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Created:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'created_at'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Updated:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'updated_at'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Description:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ol start="6"><li>概述最受欢迎的仓库</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> requests
<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&quot;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Status code:&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total repositories:'</span><span class="token punctuation">,</span>response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Repositories returned:'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dicts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nSelected information about first repository:'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Name:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Owner:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'owner'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Stars:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Repository:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'html_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Created:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'created_at'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Updated:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'updated_at'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Description:'</span><span class="token punctuation">,</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="7"><li>监视API的速率限制
大多数API都存在速率限制,即你在特定时间内可执行的请求数存在限制.要获悉你是否接近了GitHub的限制,请在浏览器中输入<code>https://api.github.com/rate_limit</code>,你将看到如下:</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;core&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
      <span class="token property">&quot;remaining&quot;</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
      <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token number">1575429256</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;search&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">&quot;remaining&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token number">1575425716</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;graphql&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;remaining&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token number">1575429256</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;integration_manifest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;remaining&quot;</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token number">1575429256</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;rate&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token property">&quot;remaining&quot;</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token number">1575429256</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到search中限制为每分钟10条.</p> <h3 id="使用pygal可视化仓库"><a href="#使用pygal可视化仓库" class="header-anchor">#</a> 使用Pygal可视化仓库</h3> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> pygal
<span class="token keyword">from</span> pygal<span class="token punctuation">.</span>style <span class="token keyword">import</span> LightColorizedStyle <span class="token keyword">as</span> LCS<span class="token punctuation">,</span> LightenStyle <span class="token keyword">as</span> LS
<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&quot;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Status code:&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total repositories:'</span><span class="token punctuation">,</span>response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
names<span class="token punctuation">,</span> stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    stars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 可视化</span>
my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>
<span class="token comment"># x_label_rotation 让标签绕X轴旋转45度,show_legend=False 隐藏图例</span>
chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span>style<span class="token operator">=</span>my_style<span class="token punctuation">,</span> x_label_rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> show_legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Most-Starred Python Projects on GitHub'</span>
chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> names
chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> stars<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'python_repos.svg'</span><span class="token punctuation">)</span>
</code></pre></div><ol><li>改进Pygal图表</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> pygal
<span class="token keyword">from</span> pygal<span class="token punctuation">.</span>style <span class="token keyword">import</span> LightColorizedStyle <span class="token keyword">as</span> LCS<span class="token punctuation">,</span> LightenStyle <span class="token keyword">as</span> LS
<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&quot;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Status code:&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total repositories:'</span><span class="token punctuation">,</span>response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
names<span class="token punctuation">,</span> stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    stars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 可视化</span>
my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>

my_config <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># x 轴标签旋转45度</span>
my_config<span class="token punctuation">.</span>x_label_rotation <span class="token operator">=</span> <span class="token number">45</span>
<span class="token comment"># 隐藏图例</span>
my_config<span class="token punctuation">.</span>show_legend <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 修改字体大小</span>
my_config<span class="token punctuation">.</span>title_font_size <span class="token operator">=</span> <span class="token number">24</span>
my_config<span class="token punctuation">.</span>label_font_size <span class="token operator">=</span> <span class="token number">14</span>
my_config<span class="token punctuation">.</span>major_label_font_size <span class="token operator">=</span> <span class="token number">18</span>
<span class="token comment"># 将较长的项目名缩短为15个字符</span>
my_config<span class="token punctuation">.</span>truncate_label <span class="token operator">=</span> <span class="token number">15</span>
<span class="token comment"># 隐藏图表中的水平线</span>
my_config<span class="token punctuation">.</span>show_y_guides <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 设置了自定义宽度</span>
my_config<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1000</span>

chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span>my_config<span class="token punctuation">,</span> style<span class="token operator">=</span>my_style<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Most-Starred Python Projects On GitHub'</span>
chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> names
chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> stars<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'python_repos.svg'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>添加自定义工具提示
可以通过向add()传递一个字典列表,而不是值列表.<br> <code>chart.add('', [{'value':1, 'label':'desc'}])</code></li> <li>根据数据绘图</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> pygal
<span class="token keyword">from</span> pygal<span class="token punctuation">.</span>style <span class="token keyword">import</span> LightColorizedStyle <span class="token keyword">as</span> LCS<span class="token punctuation">,</span> LightenStyle <span class="token keyword">as</span> LS
<span class="token comment"># 执行API调用并存储响应</span>
url <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&quot;</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Status code:&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 将API响应存储在一个变量中</span>
response_dict <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total repositories:'</span><span class="token punctuation">,</span>response_dict<span class="token punctuation">[</span><span class="token string">'total_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 研究有关仓库的信息</span>
repo_dicts <span class="token operator">=</span> response_dict<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Number of items:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>repo_dicts<span class="token punctuation">)</span><span class="token punctuation">)</span>
names<span class="token punctuation">,</span> plot_dicts <span class="token punctuation">,</span>stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    stars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 注意容错,如果为null会抛出异常</span>
    plot_dict <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'value'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'label'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    plot_dicts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>plot_dict<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>plot_dicts<span class="token punctuation">)</span>
<span class="token comment"># 可视化</span>
my_style <span class="token operator">=</span> LS<span class="token punctuation">(</span><span class="token string">'#333366'</span><span class="token punctuation">,</span> base_style<span class="token operator">=</span>LCS<span class="token punctuation">)</span>

my_config <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># x 轴标签旋转45度</span>
my_config<span class="token punctuation">.</span>x_label_rotation <span class="token operator">=</span> <span class="token number">45</span>
<span class="token comment"># 隐藏图例</span>
my_config<span class="token punctuation">.</span>show_legend <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 修改字体大小</span>
my_config<span class="token punctuation">.</span>title_font_size <span class="token operator">=</span> <span class="token number">24</span>
my_config<span class="token punctuation">.</span>label_font_size <span class="token operator">=</span> <span class="token number">14</span>
my_config<span class="token punctuation">.</span>major_label_font_size <span class="token operator">=</span> <span class="token number">18</span>
<span class="token comment"># 将较长的项目名缩短为15个字符</span>
my_config<span class="token punctuation">.</span>truncate_label <span class="token operator">=</span> <span class="token number">15</span>
<span class="token comment"># 隐藏图表中的水平线</span>
my_config<span class="token punctuation">.</span>show_y_guides <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 设置了自定义宽度</span>
my_config<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1000</span>

chart <span class="token operator">=</span> pygal<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span>my_config<span class="token punctuation">,</span> style<span class="token operator">=</span>my_style<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Most-Starred Python Projects On GitHub'</span>
chart<span class="token punctuation">.</span>x_labels <span class="token operator">=</span> names
chart<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> plot_dicts<span class="token punctuation">)</span>
chart<span class="token punctuation">.</span>render_to_file<span class="token punctuation">(</span><span class="token string">'python_repos.svg'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>在图表中添加可单击的链接
Pygal还允许你将图表中的每个条形用作网站的链接.为此,只需添加一行代码,在为每个项目创建的字典中,添加一个键为'xlink'的键值对:</li></ol> <div class="language-py extra-class"><pre class="language-py"><code><span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
<span class="token keyword">for</span> repo_dict <span class="token keyword">in</span> repo_dicts<span class="token punctuation">:</span>
    names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    stars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 注意容错,如果为null会抛出异常</span>
    plot_dict <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'value'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'stargazers_count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'label'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'xlink'</span><span class="token punctuation">:</span> repo_dict<span class="token punctuation">[</span><span class="token string">'html_url'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    plot_dicts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>plot_dict<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#安装-matplotlib" title="安装 matplotlib">安装 matplotlib</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#matplotlib-画廊" title="matplotlib 画廊">matplotlib 画廊</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#绘制简单的折线图" title="绘制简单的折线图">绘制简单的折线图</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#使用scatter-绘制散点图并设置其样式" title="使用scatter()绘制散点图并设置其样式">使用scatter()绘制散点图并设置其样式</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#随机漫步" title="随机漫步">随机漫步</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#使用pygal-模拟掷骰子" title="使用Pygal 模拟掷骰子">使用Pygal 模拟掷骰子</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#下载数据" title="下载数据">下载数据</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#csv" title="CSV">CSV</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#json" title="JSON">JSON</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#使用api" title="使用API">使用API</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#使用web-api" title="使用Web API">使用Web API</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#使用pygal可视化仓库" title="使用Pygal可视化仓库">使用Pygal可视化仓库</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.91516f2d.js" defer></script><script src="/assets/js/7.58fd3bc6.js" defer></script><script src="/assets/js/4.d132524d.js" defer></script><script src="/assets/js/31.b3c49d70.js" defer></script>
  </body>
</html>
